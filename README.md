# ReentrancyDemo

Reentrancyæ”»æ’ƒã¨é˜²å¾¡æ–¹æ³•ã‚’å­¦ã¶ãŸã‚ã®å®Ÿè·µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

## ğŸ“š æ¦‚è¦

ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã§æœ€ã‚‚é‡è¦ãªReentrancyæ”»æ’ƒã«ã¤ã„ã¦ã€å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã—ã¦å­¦ç¿’ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¢ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€‚

2016å¹´ã®The DAOäº‹ä»¶ï¼ˆè¢«å®³é¡60å„„å††ç›¸å½“ï¼‰ã®åŸå› ã¨ãªã£ãŸè„†å¼±æ€§ã‚’å†ç¾ã—ã€é˜²å¾¡æ–¹æ³•ã‚’å®Ÿè£…ã€‚

## ğŸ¯ å­¦ç¿’å†…å®¹

- âœ… Reentrancyæ”»æ’ƒã®ä»•çµ„ã¿
- âœ… è„†å¼±ãªã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å®Ÿè£…
- âœ… æ”»æ’ƒã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å®Ÿè£…
- âœ… Checks-Effects-Interactionsãƒ‘ã‚¿ãƒ¼ãƒ³
- âœ… OpenZeppelin ReentrancyGuardã®ä½¿ç”¨

## ğŸ”¥ å®Ÿè£…å†…å®¹

### 1. VulnerableBank.sol
è„†å¼±ãªéŠ€è¡Œã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã€‚Reentrancyæ”»æ’ƒã‚’å—ã‘ã‚‹ã€‚

### 2. Attacker.sol
æ”»æ’ƒè€…ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã€‚receive()é–¢æ•°ã§å†å¸°çš„ã«å¼•ãå‡ºã—ã‚’å®Ÿè¡Œã€‚

### 3. SecureBank.sol
Checks-Effects-Interactionsãƒ‘ã‚¿ãƒ¼ãƒ³ã§é˜²å¾¡ã€‚

### 4. UltraSecureBank.sol
OpenZeppelinã®ReentrancyGuardã§å®Œå…¨é˜²å¾¡ã€‚

## ğŸ§ª ãƒ†ã‚¹ãƒˆçµæœ
```
æ”»æ’ƒæˆåŠŸã®ä¾‹ï¼ˆVulnerableBankï¼‰:
- åˆæœŸçŠ¶æ…‹: éŠ€è¡Œæ®‹é«˜ 10 ETH
- æ”»æ’ƒè€…ã®æŠ•è³‡: 1 ETH
- æ”»æ’ƒå¾Œ: æ”»æ’ƒè€…ãŒ 11 ETH ç›—ã‚€ï¼ˆ11å›ã®å†å¸°å‘¼ã³å‡ºã—ï¼‰
- éŠ€è¡Œæ®‹é«˜: 0 ETH
```

## ğŸ› ï¸ ä½¿ç”¨æŠ€è¡“

- Solidity ^0.8.0
- Hardhat
- OpenZeppelin Contracts
- Ethers.js
- Chai (ãƒ†ã‚¹ãƒˆ)

## ğŸš€ å®Ÿè¡Œæ–¹æ³•
```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npx hardhat test

# æ”»æ’ƒæˆåŠŸã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
npx hardhat test --grep "æ”»æ’ƒãŒæˆåŠŸ"
```

## ğŸ“– å­¦ç¿’ã®æˆæœ

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é€šã˜ã¦ã€ä»¥ä¸‹ã‚’ç¿’å¾—ï¼š

1. **æ”»æ’ƒã®ç†è§£**: ãªãœReentrancyæ”»æ’ƒãŒç™ºç”Ÿã™ã‚‹ã®ã‹
2. **é˜²å¾¡ã®å®Ÿè£…**: 2ã¤ã®é˜²å¾¡ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…
3. **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**: OpenZeppelinãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ´»ç”¨

## ğŸ‘¤ ä½œæˆè€…

**Tatsu**  
GitHub: [@code-craftsman369](https://github.com/code-craftsman369)  
Twitter: [@web3_builder369](https://twitter.com/web3_builder369)

## ğŸ“ å‚è€ƒè³‡æ–™

- [The DAO Hack (2016)](https://en.wikipedia.org/wiki/The_DAO_(organization))
- [OpenZeppelin ReentrancyGuard](https://docs.openzeppelin.com/contracts/4.x/api/security#ReentrancyGuard)

## âš ï¸ æ³¨æ„äº‹é …

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯**æ•™è‚²ç›®çš„**ã§ã™ã€‚å®Ÿéš›ã®ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆã§è„†å¼±ãªã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãªã„ã§ãã ã•ã„ã€‚